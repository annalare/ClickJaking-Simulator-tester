<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de Clickjacking - Monitoramento</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: #09090b;
        min-height: 100vh;
        padding: 40px 20px;
        color: #fafafa;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        margin-bottom: 8px;
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #fff 0%, #a1a1aa 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.02em;
      }

      .subtitle {
        text-align: center;
        color: #71717a;
        margin-bottom: 40px;
        font-size: 1.1rem;
      }

      .warning-box {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
        border: 1px solid rgba(239, 68, 68, 0.2);
        padding: 20px 24px;
        margin-bottom: 40px;
        border-radius: 16px;
        backdrop-filter: blur(10px);
      }

      .warning-box h3 {
        color: #fca5a5;
        margin-bottom: 10px;
        font-weight: 600;
        font-size: 1rem;
      }

      .warning-box p {
        color: #a1a1aa;
        line-height: 1.6;
      }

      .test-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
        gap: 24px;
        margin-top: 24px;
      }

      .test-card {
        background: #18181b;
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid #27272a;
        transition: all 0.3s ease;
      }

      .test-card:hover {
        border-color: #3f3f46;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        transform: translateY(-2px);
      }

      .test-header {
        padding: 20px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #27272a;
        background: rgba(39, 39, 42, 0.3);
      }

      .test-header h3 {
        font-size: 15px;
        font-weight: 600;
        color: #e4e4e7;
      }

      .status {
        padding: 6px 14px;
        border-radius: 100px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .status.blocked {
        background: rgba(34, 197, 94, 0.15);
        color: #4ade80;
        border: 1px solid rgba(34, 197, 94, 0.3);
      }

      .status.allowed {
        background: rgba(250, 204, 21, 0.15);
        color: #fde047;
        border: 1px solid rgba(250, 204, 21, 0.3);
      }

      .status.loading {
        background: rgba(59, 130, 246, 0.15);
        color: #60a5fa;
        border: 1px solid rgba(59, 130, 246, 0.3);
      }

      .iframe-container {
        position: relative;
        height: 380px;
        background: #0c0c0e;
      }

      .iframe-container iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      .overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: rgba(9, 9, 11, 0.98);
        padding: 24px;
        text-align: center;
      }

      .overlay.hidden {
        display: none;
      }

      .overlay .icon {
        font-size: 56px;
        margin-bottom: 20px;
        filter: grayscale(0.2);
      }

      .overlay h4 {
        margin-bottom: 12px;
        color: #fafafa;
        font-weight: 600;
        font-size: 1.1rem;
      }

      .overlay p {
        color: #71717a;
        font-size: 14px;
        max-width: 320px;
        line-height: 1.5;
      }

      .url-info {
        padding: 14px 24px;
        background: #0f0f11;
        border-top: 1px solid #27272a;
        font-family: 'JetBrains Mono', monospace;
        font-size: 12px;
        color: #a1a1aa;
        word-break: break-all;
      }

      .controls {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-bottom: 40px;
        flex-wrap: wrap;
      }

      .controls input {
        padding: 14px 20px;
        border-radius: 12px;
        border: 1px solid #27272a;
        background: #18181b;
        color: #fafafa;
        font-size: 14px;
        font-family: 'JetBrains Mono', monospace;
        width: 380px;
        transition: all 0.2s ease;
      }

      .controls input:focus {
        outline: none;
        border-color: #3f3f46;
        box-shadow: 0 0 0 3px rgba(63, 63, 70, 0.3);
      }

      .controls input::placeholder {
        color: #52525b;
      }

      .controls button {
        padding: 14px 32px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(135deg, #fafafa 0%, #d4d4d8 100%);
        color: #09090b;
        font-size: 14px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
        font-family: 'Inter', sans-serif;
      }

      .controls button:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 30px -10px rgba(255, 255, 255, 0.2);
      }

      .controls button:active {
        transform: translateY(0);
      }

      .result-box {
        margin-top: 40px;
        padding: 24px;
        background: #18181b;
        border-radius: 20px;
        border: 1px solid #27272a;
      }

      .result-box h3 {
        margin-bottom: 20px;
        color: #fafafa;
        font-weight: 600;
      }

      .result-item {
        display: flex;
        justify-content: space-between;
        padding: 14px 0;
        border-bottom: 1px solid #27272a;
      }

      .result-item:last-child {
        border-bottom: none;
      }

      .check {
        color: #4ade80;
      }

      .cross {
        color: #f87171;
      }

      .info-section {
        margin-top: 32px;
        padding: 28px;
        background: #18181b;
        border-radius: 20px;
        border: 1px solid #27272a;
      }

      .info-section h3 {
        color: #fafafa;
        margin-bottom: 20px;
        font-weight: 600;
        font-size: 1.1rem;
      }

      .info-section code {
        background: #27272a;
        padding: 4px 10px;
        border-radius: 6px;
        color: #a78bfa;
        font-family: 'JetBrains Mono', monospace;
        font-size: 13px;
      }

      .info-section ul {
        margin-left: 20px;
        margin-top: 16px;
      }

      .info-section li {
        margin-bottom: 12px;
        color: #a1a1aa;
        line-height: 1.6;
      }

      .info-section li strong {
        color: #e4e4e7;
      }

      @media (max-width: 600px) {
        .test-grid {
          grid-template-columns: 1fr;
        }

        .controls input {
          width: 100%;
        }

        h1 {
          font-size: 1.8rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Teste de Protecao contra Clickjacking</h1>
      <p class="subtitle">Simulando tentativa de ataque no projeto</p>

      <div class="warning-box">
        <h3>O que este teste faz?</h3>
        <p>
          Esta pagina simula um site malicioso tentando carregar seu aplicativo
          dentro de iframes. Se a protecao estiver funcionando, os iframes das
          rotas protegidas nao devem carregar.
        </p>
      </div>

      <div class="controls">
        <input
          type="text"
          id="baseUrl"
          placeholder="URL base"
          value="https://happy-game-nextjs.vercel.app"
        />
        <button onclick="runTests()">Executar Testes</button>
      </div>

      <div class="test-grid">
        <!-- Teste 1: Rota raiz -->
        <div class="test-card">
          <div class="test-header">
            <h3>Teste 1: Rota Principal (/)</h3>
            <span class="status blocked" id="status1">DEVE BLOQUEAR</span>
          </div>
          <div class="iframe-container">
            <iframe
              id="iframe1"
              sandbox="allow-scripts allow-same-origin"
            ></iframe>
            <div class="overlay" id="overlay1">
              <div class="icon">&#128274;</div>
              <h4>Aguardando teste...</h4>
              <p>Clique em "Executar Testes" para iniciar</p>
            </div>
          </div>
          <div class="url-info" id="url1">URL: -</div>
        </div>

        <!-- Teste 2: Rota /cadastro -->
        <div class="test-card">
          <div class="test-header">
            <h3>Teste 2: Rota de Cadastro (/cadastro)</h3>
            <span class="status blocked" id="status2">DEVE BLOQUEAR</span>
          </div>
          <div class="iframe-container">
            <iframe
              id="iframe2"
              sandbox="allow-scripts allow-same-origin"
            ></iframe>
            <div class="overlay" id="overlay2">
              <div class="icon">&#128274;</div>
              <h4>Aguardando teste...</h4>
              <p>Clique em "Executar Testes" para iniciar</p>
            </div>
          </div>
          <div class="url-info" id="url2">URL: -</div>
        </div>

        <!-- Teste 3: Rota /login -->
        <div class="test-card">
          <div class="test-header">
            <h3>Teste 3: Rota de Login (/login)</h3>
            <span class="status blocked" id="status3">DEVE BLOQUEAR</span>
          </div>
          <div class="iframe-container">
            <iframe
              id="iframe3"
              sandbox="allow-scripts allow-same-origin"
            ></iframe>
            <div class="overlay" id="overlay3">
              <div class="icon">&#128274;</div>
              <h4>Aguardando teste...</h4>
              <p>Clique em "Executar Testes" para iniciar</p>
            </div>
          </div>
          <div class="url-info" id="url3">URL: -</div>
        </div>
      </div>

      <div class="result-box" id="resultBox" style="display: none">
        <h3>Resultado dos Testes</h3>
        <div id="results"></div>
      </div>

      <div class="info-section">
        <h3>Como verificar manualmente?</h3>
        <ul>
          <li>
            Abra o <strong>DevTools</strong> (F12) e va na aba
            <strong>Console</strong>
          </li>
          <li>
            Se a protecao estiver funcionando, voce vera erros como: <br /><code
              >Refused to display 'http://localhost:5173/' in a frame because it
              set 'X-Frame-Options' to 'deny'</code
            >
          </li>
          <li>
            Na aba <strong>Network</strong>, verifique os headers de resposta -
            deve conter: <br /><code>X-Frame-Options: DENY</code> <br /><code
              >Content-Security-Policy: frame-ancestors 'none'</code
            >
          </li>
        </ul>
      </div>

      <div class="info-section">
        <h3>Headers implementados</h3>
        <ul>
          <li>
            <code>X-Frame-Options: DENY</code> - Header classico, suportado por
            navegadores antigos
          </li>
          <li>
            <code>Content-Security-Policy: frame-ancestors 'none'</code> -
            Header moderno, mais flexivel
          </li>
          <li>
            <code>X-Content-Type-Options: nosniff</code> - Previne MIME type
            sniffing
          </li>
          <li>
            <code>Referrer-Policy: strict-origin-when-cross-origin</code> -
            Controla informacoes de referrer
          </li>
        </ul>
      </div>
    </div>

    <script>
      const testConfigs = [
        { id: 1, path: "/", shouldBlock: true },
        { id: 2, path: "/cadastro", shouldBlock: true },
        { id: 3, path: "/login", shouldBlock: true },
      ];

      function runTests() {
        const baseUrl = document
          .getElementById("baseUrl")
          .value.replace(/\/$/, "");
        const results = [];

        testConfigs.forEach((config) => {
          const url = baseUrl + config.path;
          const iframe = document.getElementById(`iframe${config.id}`);
          const overlay = document.getElementById(`overlay${config.id}`);
          const urlInfo = document.getElementById(`url${config.id}`);
          const status = document.getElementById(`status${config.id}`);

          urlInfo.textContent = `URL: ${url}`;
          overlay.innerHTML = `
                    <div class="icon">&#9203;</div>
                    <h4>Carregando...</h4>
                    <p>Tentando carregar o iframe</p>
                `;
          status.className = "status loading";
          status.textContent = "TESTANDO...";

          // Limpar iframe anterior
          iframe.src = "about:blank";

          // Pequeno delay para resetar
          setTimeout(() => {
            iframe.src = url;
          }, 100);

          // Verificar apos alguns segundos
          setTimeout(() => {
            checkIframeLoaded(config, baseUrl);
          }, 3000);
        });
      }

      function checkIframeLoaded(config, baseUrl) {
        const iframe = document.getElementById(`iframe${config.id}`);
        const overlay = document.getElementById(`overlay${config.id}`);
        const status = document.getElementById(`status${config.id}`);

        let loaded = false;

        try {
          // Tentar acessar o conteudo do iframe
          // Se bloqueado por X-Frame-Options, isso vai falhar
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;

          // Se chegou aqui e tem conteudo, o iframe carregou
          if (
            iframeDoc &&
            iframeDoc.body &&
            iframeDoc.body.innerHTML.length > 0
          ) {
            loaded = true;
          }
        } catch (e) {
          // Cross-origin error - pode significar que carregou mas nao podemos acessar
          // ou que foi bloqueado
          console.log(`Iframe ${config.id} error:`, e.message);
        }

        // Verificar se o iframe tem dimensoes (outro indicador de carregamento)
        const iframeRect = iframe.getBoundingClientRect();

        if (config.shouldBlock) {
          // Deveria bloquear
          if (!loaded) {
            // Sucesso - foi bloqueado
            overlay.innerHTML = `
                        <div class="icon">&#9989;</div>
                        <h4 style="color: #4ade80;">PROTEGIDO!</h4>
                        <p>O iframe foi bloqueado corretamente pelos headers de seguranca.</p>
                    `;
            status.className = "status blocked";
            status.textContent = "BLOQUEADO";
          } else {
            // Falha - deveria bloquear mas carregou
            overlay.classList.add("hidden");
            status.className = "status";
            status.style.background = "#4d0d0d";
            status.style.color = "#ef4444";
            status.textContent = "VULNERAVEL!";
          }
        } else {
          // Deveria permitir (rota /embed)
          overlay.innerHTML = `
                    <div class="icon">&#9989;</div>
                    <h4 style="color: #fbbf24;">Embed permitido</h4>
                    <p>Esta rota permite iframe conforme configurado.</p>
                `;
          status.className = "status allowed";
          status.textContent = "PERMITIDO";
        }
      }

      // Listener para erros de carregamento de iframe
      window.addEventListener("message", function (event) {
        console.log("Message from iframe:", event.data);
      });
    </script>
  </body>
</html>
